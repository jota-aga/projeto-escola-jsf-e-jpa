<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
 	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	template="/WEB-INF/template/layout.xhtml">
	
	<ui:define name="titulo">#{key.aluno}</ui:define>

	<ui:define name="titulo-cabecalho">#{key.tituloCabecalhoAluno}</ui:define>
	
	<ui:define name="conteudo">
		<f:metadata>
			<f:viewAction action="#{alunoBean.procuraTodosAlunos}"/>
		</f:metadata>
		<h:form id="mainForm">
			<p:messages id="globalMessages"/>
			<p:toolbar>
				<p:toolbarGroup>
					
					<p:inputText id="termoPesquisa" placeholder="#{key.placeholderPesquisa}" value="#{alunoBean.termoPesquisa}" size="25"/>
					<p:selectOneButton id="opcaoPesquisa" value="#{alunoBean.opcaoPesquisa}" unselectable="false">
						<f:selectItem itemLabel="#{key.nome}" itemValue="nome"/>
						<f:selectItem itemLabel="#{key.matricula}" itemValue="matricula"/>
					</p:selectOneButton>
					<p:commandButton value="#{key.pesquisar}" actionListener="#{alunoBean.pesquisarAlunos()}" update="alunosDataTable" 
						icon="fa fa fa-search" process="@this termoPesquisa opcaoPesquisa"/>
					
					<span class="ui-separator">
						<span class="ui-icon ui-icon-grip-dotted-vertical"/>
					</span>
					
					<p:commandButton value="#{key.novo}" update="dialogAluno" actionListener="#{alunoBean.prepararAlunoNovo()}" 
						oncomplete="PF('dialogAlunoWidgetVar').show()" process="@this">
						<p:resetInput target="dialogAluno"/>
					</p:commandButton>
					
					<span class="ui-separator">
						<span class="ui-icon ui-icon-grip-dotted-vertical"/>
					</span>
					<p:commandButton value="Exportar PDF" ajax="false">
						<p:dataExporter type="pdf" target="alunosDataTable" fileName="tabela-de-dados-alunos"/>
					</p:commandButton>
				</p:toolbarGroup>
			</p:toolbar>
			<p:dataTable id="alunosDataTable" value="#{alunoBean.todosAlunos}" var="aluno" rowKey="#{aluno.id}" emptyMessage="#{key.mensagemVaziaAluno}" >
				<p:column headerText="#{key.aluno}">
					<h:outputText value="#{aluno.nome}"/>
				</p:column>
				
				<p:column headerText="#{key.matricula}">
					<h:outputText value="#{aluno.matricula}"/>
				</p:column>
				
				<p:column headerText="#{key.dataNascimento}">
					<h:outputText value="#{aluno.dataNascimento}"/>
				</p:column>
				
				<p:column headerText="#{key.acoes}">
					<p:commandButton value="#{key.editar}" actionListener="#{alunoBean.prepararAlunoEdicao(aluno)}" process="@this" 
					oncomplete="PF('dialogAlunoWidgetVar').show()" update="mainForm:dialogAluno">
						<p:resetInput target="mainForm:dialogAluno"/>
					</p:commandButton>
					<p:commandButton value="#{key.excluir}" actionListener="#{alunoBean.excluirAluno(aluno)}" update="mainForm:alunosDataTable mainForm:globalMessages" 
						process="@this"/>
					<p:commandButton value="#{key.adicionarNota}" actionListener="#{alunoBean.prepararAdicaoNota(aluno)}" update="mainForm:dialogNota"
					process="@this" oncomplete="PF('dialogNotaWidgetVar').show()">
						<p:resetInput target="mainForm:dialogNota"/>
					</p:commandButton>
					
				</p:column>
			</p:dataTable>
			
			<p:dialog id="dialogAluno" widgetVar="dialogAlunoWidgetVar" modal="true" resizable="false" header="#{key.formularioAluno}">
				<p:panelGrid columns="1" rendered="#{alunoBean.aluno ne null}">
					<p:outputLabel for="nome" value="#{key.nome}: "/>
					<p:message id="nomeMessage" for="nome"/>
					<p:inputText id="nome" value="#{alunoBean.aluno.nome}" size="45"/>
					
					<p:outputLabel for="matricula" value="#{key.matricula}: "/>
					<p:message id="matriculaMessage" for="matricula"/>
					<p:inputText id="matricula" value="#{alunoBean.aluno.matricula}" size="45"/>
					
					<p:outputLabel for="dataNascimento" value="#{key.dataNascimento}: "/>
					<p:message id="dataNascimentoMessage" for="dataNascimento"/>
					<p:calendar id="dataNascimento" value="#{alunoBean.aluno.dataNascimento}" pattern="dd/MM/yyyy" mask="99/99/9999"/>
					
					<p:outputLabel for="cursos" value="#{key.cursos}: "/>
					<p:message id="cursosMessage" for="cursos"/>
					<p:selectManyCheckbox id="cursos" value="#{alunoBean.cursosSelecionados}" converter="#{alunoBean.cursoConverter}">
						<f:selectItems value="#{alunoBean.cursos}" var="curso" itemLabel="#{curso.nome}" itemValue="#{curso}"/>
					</p:selectManyCheckbox>
					
					<p:commandButton value="#{key.salvar}:" actionListener="#{alunoBean.salvarAluno()}" oncomplete="if(!args.validationFailed) PF('dialogAlunoWidgetVar').hide()" 
					update="alunosDataTable nomeMessage matriculaMessage dataNascimentoMessage cursosMessage" process="@this dialogAluno"/>
				</p:panelGrid>
			</p:dialog>
			
			<p:dialog	id="dialogNota" widgetVar="dialogNotaWidgetVar" header="#{key.formularioNota}" modal="true" resizable="false">
				<p:panelGrid columns="1" rendered="#{alunoBean.nota ne null}">
					<p:outputLabel for="nomeAluno" value="#{key.nome}:"/>
					<h:outputText id="nomeAluno" value="#{alunoBean.nota.aluno.nome}"/>
					
					<p:outputLabel for="nota" value="#{key.nota}:"/>
					<p:inputNumber id="nota" maxlength="2" value="#{alunoBean.nota.nota}"/>
					
					<p:outputLabel for="curso" value="#{key.curso}:"/>
					<p:selectOneMenu id="curso" value="#{alunoBean.nota.curso}" converter="#{alunoBean.cursoConverter}">
						<f:selectItems value="#{alunoBean.cursosSelecionados}" var="curso" itemLabel="#{curso.nome}" itemValue="#{curso}"/>
					</p:selectOneMenu>
					
					<p:commandButton value="#{key.adicionarNota}" actionListener="#{alunoBean.salvarNota}" process="@this dialogNota" 
						oncomplete="if(!args.validationFailed) PF(dialogNota').hide()">
					
					</p:commandButton>
				</p:panelGrid>
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>